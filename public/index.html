<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sign-In</title>
</head>

<body>
    <h1>Google Sign-In</h1>
    <hr>

    <!-- Selector del bot贸n -->
    <div id="buttonDiv"></div>

    <script>

        // boton de salir
        const button = document.getElementById("g_id_signout")

        window.onload = function () {
            google.accounts.id.initialize({
                // GOOGLE_CLIENT_ID
                client_id: "656202371387-3f9mk4s8qvb360ff1hghsjnuj3mmv2gg.apps.googleusercontent.com",
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                // ID en html del boton
                document.getElementById("buttonDiv"), {
                // Personalizar bot贸n
                type: "standard",
                shape: "pill",
                theme: "filled_black",
                size: "large",
                text: "Iniciar sesi贸n con Google",
                locales: "es",
                width: "40",
            }
            );

            // Mostrar dialogo de Google
            google.accounts.id.prompt();

            // Escuchar la respuesta de la credenciales
            function handleCredentialResponse(response) {

                const responsePayload = parseJwt(response.credential);

                const data = {
                    "JWT ID Token": response.credential,
                    "ID Google": responsePayload.sub,
                    "Full Name": responsePayload.name,
                    "Given Name": responsePayload.given_name,
                    "Last Name": responsePayload.family_name,
                    "Image URL": responsePayload.picture,
                    "Email": responsePayload.email
                }

                console.log(data);

            }

            // Parsear jwt
            function parseJwt(token) {
                // toma el payload del token
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace('-', '+').replace('_', '/');

                /*

                    btoa
                    btoa() codifica un string en Base64

                    decodi
                    atob() funci贸n que decodifica un String cuya
                    data ha sido codificada en Base64
                */
                return JSON.parse(window.atob(base64));
            };
        }

    </script>

    <!-- Script de Google SignIn -->
    <script src="https://accounts.google.com/gsi/client" referrerpolicy="no-referrer-when-downgrade" async
        defer></script>

</body>

</html>